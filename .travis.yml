---
dist: focal
language: python
cache: pip

branches:
  only:
  - master

notifications:
  email: false

git:
  depth: 5

# setup tests
env:
  global:
  - TF_VERSION='1.1.7'
  - TF_IN_AUTOMATION=true

os: linux
python: 3.9

# execute tests
install:
- sudo wget "https://releases.hashicorp.com/terraform/${TF_VERSION}/terraform_${TF_VERSION}_linux_amd64.zip"
- sudo unzip "terraform_${TF_VERSION}_linux_amd64.zip" -d /usr/bin/

before_script:
- terraform init -backend=false -no-color
- cd acceptance && terraform init -no-color
- pip install ansible

script:
- terraform validate -no-color
- terraform fmt -diff -check -no-color
- cd acceptance && terraform apply -input=false -no-color -auto-approve
